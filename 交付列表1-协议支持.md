# 协议支持测试
### 0. 测试环境

参数 | 描述
---|---
Physical | Server: 251, 252
System | CentOS Linux release 7.2.1511
Linux kernel | 3.10.0-327.el7.x86_64
CPU |Intel(R) Xeon(R) CPU E5-2650 v3 @ 2.30GHz <测试默认均为使用单个核，占用100%>
Hugepage |16*1G
VPP version |16.09
Ethernet|Intel Corporation 82599ES 10-Gigabit


### 1. 安装 vpp
#### a. 添加 fd.io 源

> CentOS 7.2 - VPP Release RPMs (VPP 16.09)

新建文件 ```/etc/yum.repos.d/fdio-release.repo```
其内容如下：
```
[fdio-release]
name=fd.io release branch latest merge
baseurl=https://nexus.fd.io/content/repositories/fd.io.centos7/
enabled=1
gpgcheck=0
```

#### b. yum安装
```
sudo yum install vpp
```

### 2. 安装 dpdk
从官方网址下载dpdk源码包，解压后利用脚本工具编译安装。
```
tar xJf dpdk-<version>.tar.xz
cd dpdk-<version>/tools
./dpdk-setup.sh
```

在第一栏```Select the DPDK environment to build```中选择```x86_64-native-linuxapp-gcc```

```
----------------------------------------------------------
 Step 1: Select the DPDK environment to build
----------------------------------------------------------
[1] arm64-armv8a-linuxapp-gcc
[2] arm64-dpaa2-linuxapp-gcc
[3] arm64-thunderx-linuxapp-gcc
[4] arm64-xgene1-linuxapp-gcc
[5] arm-armv7a-linuxapp-gcc
[6] i686-native-linuxapp-gcc
[7] i686-native-linuxapp-icc
[8] ppc_64-power8-linuxapp-gcc
[9] tile-tilegx-linuxapp-gcc
[10] x86_64-native-bsdapp-clang
[11] x86_64-native-bsdapp-gcc
[12] x86_64-native-linuxapp-clang
[13] x86_64-native-linuxapp-gcc
[14] x86_64-native-linuxapp-icc
[15] x86_x32-native-linuxapp-gcc
```
如上选择13即可。

等待编译安装完成，在dpdk目录下会出现x86_64-native-linuxapp-gcc目录。
### 3. 配置 hugepage

查看系统是否支持1G大页：
```
cat /proc/cpuinfo | grep pdpe1gb
```

查看系统是否支持2M大页：
```
$cat /proc/cpuinfo | grep pse
```

在```/etc/default/grub```文件中的```GRUB_CMDLINE_LINUX=``` 后添加1G大页的默认配置信息，例：```default_hugepagesz=1G hugepagesz=1G hugepages=16```
如果配置2M大页，例：``` default_hugepagesz=2M hugepagesz=2M hugepages=1024```

更新grub使其生效
```
update-grub # if ubuntu
grub2-mkconfig -o /boot/grub2/grub.cfg # if centos
```

在```~/.bashrc```中添加如下信息
```
mkdir –p /mnt/huge
mount -t hugetlbfs nodev /mnt/huge
```
如果是1G大页，文件夹名```huge```变更为```huge_1GB```


配置```/etc/fstab```在末尾添加
```
nodev /mnt/huge hugetlbfs defaults 0 0
```
如果是1G大页：
```
nodev /mnt/huge_1GB hugetlbfs pagesize=1GB 0 0
```

重启生效。

### 4. 启动 vpp

a. 修改配置文件```/etc/vpp/start.conf```

```
unix {
  nodaemon
  log /tmp/vpp.log
  full-coredump
}

dpdk {
    uio-driver uio_pci_generic
    dev 0000:81:00.0
    socket-mem 8192
}

api-trace {
  on
}

api-segment {
  gid vpp
}
```

关闭网络设备

```
ifconfig ens5f0 down
```
加载uio_pci_generic模块，用于接管网卡
```
modprobe uio_pci_generic
```
启动vpp
```
service vpp start
```

b. 配置vpp内部网路结构

>251

配置网卡IP
```
vppctl set int ip addr TenGigabitEthernet81/0/0 10.3.0.1/24
```

启动网卡 

```
vppctl set int state TenGigabitEthernet81/0/0 up
```
删除可能存在的socket文件，并新建vhost-user的socket文件。
```
rm -f /tmp/vhost1.sock
vppctl create vhost-user socket /tmp/vhost1.sock server
```
启动vhost-user的虚拟网卡
```
vppctl set int state VirtualEthernet0/0/0 up
```
配置虚拟网卡所在网桥为200， SHG设为0
```
vppctl set int l2 bridge VirtualEthernet0/0/0 200 0
```
建立vpp的vxlan隧道

- 源IP设为251上的vpp的物理网卡IP，10.3.0.1。

- 目的IP设为252上的vpp的物理网卡的IP，10.3.0.2.
- VNI 设为 200 
```
vppctl create vxlan tunnel src 10.3.0.1 dst 10.3.0.2 vni 200
```
vpp的vxlan隧道在vpp中显示状态类似于一块网卡，让两个虚拟网卡通过vxlan隧道通信需要将vxlan隧道和虚拟网卡的网桥一致，配置vxlan网桥为200.SHG设为1.
```
vppctl set int l2 bridge vxlan_tunnel0 200 1
```

查看网桥详细信息
```
[root@localhost zym]# vppctl show bridge 200 detail
  ID   Index   Learning   U-Forwrd   UU-Flood   Flooding   ARP-Term     BVI-Intf   
 200     1        on         on         on         on         off          N/A     

           Interface           Index  SHG  BVI  TxFlood        VLAN-Tag-Rewrite       
     VirtualEthernet0/0/0        2     0    -      *                 none             
         vxlan_tunnel0           3     1    -      *                 none             
```

>252:

配置与251类似
```
vppctl set int ip addr TenGigabitEthernet81/0/0 10.3.0.2/24
vppctl set int state TenGigabitEthernet81/0/0 up

rm -f /tmp/vhost2.sock
vppctl create vhost-user socket /tmp/vhost2.sock server
vppctl set int state VirtualEthernet0/0/0 up
vppctl set int l2 bridge VirtualEthernet0/0/0 200 0

vppctl create vxlan tunnel src 10.3.0.2 dst 10.3.0.1 vni 200
vppctl set int l2 bridge vxlan_tunnel0 200 1
```

### 5. 启动 VM

qemu 版本
```
[root@localhost ~]# virsh version
Compiled against library: libvirt 2.0.0
Using library: libvirt 2.0.0
Using API: QEMU 2.0.0
Running hypervisor: QEMU 2.6.0
```

>251

- 建立虚拟机
```
virt-install --virt-type kvm --name VM1 --ram 4096 --vcpus=1 --network network=default --cdrom /root/CentOS-7-x86_64-Minimal-1611.iso --disk path=/vm-images/vm1.img,size=8 --graphics vnc,listen=0.0.0.0 --noautoconsole --os-type=linux --os-variant=rhel7
```
- 修改VM1配置
```
virsh edit VM1
```
主要改动关于使能 vhost-user。

```
<domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
  <name>VM1</name>
  <uuid>b9061ec4-e224-44e4-bb81-def82aef553d</uuid>
  <memory unit='KiB'>8388608</memory>
  <currentMemory unit='KiB'>8388608</currentMemory>
  <vcpu placement='static'>1</vcpu>
  ...
  </devices>
  <qemu:commandline>
    <qemu:arg value='-chardev'/>
    <qemu:arg value='socket,id=char0,path=/tmp/vhost1.sock'/>
    <qemu:arg value='-netdev'/>
    <qemu:arg value='vhost-user,id=mynet2,chardev=char0'/>
    <qemu:arg value='-device'/>
    <qemu:arg value='virtio-net-pci,netdev=mynet2,mac=52:54:00:01:00:33'/>
    <qemu:arg value='-object'/>
    <qemu:arg value='memory-backend-file,id=mem,size=8192M,mem-path=/dev/hugepages,share=on'/>
    <qemu:arg value='-numa'/>
    <qemu:arg value='node,memdev=mem'/>
    <qemu:arg value='-mem-prealloc'/>
  </qemu:commandline>
</domain>
```


注意关闭虚拟机的selinux和firewall

修改```/etc/selinux/config```中selinux选项为disabled
```
# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=disabled
```

关闭firewalld
```
systemctl stop firewalld
systemctl disable firewalld
```

配置网卡信息

eth0 网卡通过virbr0与物理机进行通信（配置环境，拷贝软件安装包）

```/etc/sysconfig/network-scripts/ifcfg-eth0```

```
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
PEERDNS=yes
PEERROUTES=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=eth0
DEVICE=eth0
ONBOOT=yes
IPADDR=192.168.122.101
NETMASK=255.255.255.0
```
eth1 网卡通过vhost-user与vpp通信

```/etc/sysconfig/network-scripts/ifcfg-eth1```
```
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
PEERDNS=yes
PEERROUTES=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=eth1
DEVICE=eth1
ONBOOT=yes
IPADDR=10.0.0.1
NETMASK=255.255.255.0

```
> 252

指令与251类似

```
virt-install --virt-type kvm --name VM2 --ram 4096 --vcpus=1 --network network=default --cdrom /root/CentOS-7-x86_64-Minimal-1611.iso --disk path=/vm-images/vm2.img,size=8 --graphics vnc,listen=0.0.0.0 --noautoconsole --os-type=linux --os-variant=rhel7
virsh edit VM2
```


```
<domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
  <name>VM2</name>
  <uuid>36f6fc40-5416-4fe9-98d7-5120631e1f5a</uuid>
  <memory unit='KiB'>8388608</memory>
  <currentMemory unit='KiB'>8388608</currentMemory>
  <vcpu placement='static'>1</vcpu>
...
  </devices>
  <qemu:commandline>
    <qemu:arg value='-chardev'/>
    <qemu:arg value='socket,id=char0,path=/tmp/vhost2.sock'/>
    <qemu:arg value='-netdev'/>
    <qemu:arg value='vhost-user,id=mynet2,chardev=char0'/>
    <qemu:arg value='-device'/>
    <qemu:arg value='virtio-net-pci,netdev=mynet2,mac=52:54:00:01:00:44'/>
    <qemu:arg value='-object'/>
    <qemu:arg value='memory-backend-file,id=mem,size=8192M,mem-path=/dev/hugepages,share=on'/>
    <qemu:arg value='-numa'/>
    <qemu:arg value='node,memdev=mem'/>
    <qemu:arg value='-mem-prealloc'/>
  </qemu:commandline>
</domain>

```

配置网卡信息

eth0 网卡通过virbr0与物理机进行通信（配置环境，拷贝软件安装包）

```/etc/sysconfig/network-scripts/ifcfg-eth0```

```
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
PEERDNS=yes
PEERROUTES=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=eth0
DEVICE=eth0
ONBOOT=yes
IPADDR=192.168.122.102
NETMASK=255.255.255.0
```
eth1 网卡通过vhost-user与vpp通信

```/etc/sysconfig/network-scripts/ifcfg-eth1```
```
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
PEERDNS=yes
PEERROUTES=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=eth1
DEVICE=eth1
ONBOOT=yes
IPADDR=10.0.0.2
NETMASK=255.255.255.0

```

### 6. 实验架构图

![](http://oc15i8gxi.bkt.clouddn.com/vpp-doc/1/vpp-vxlan%20%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84%E5%9B%BE.png)

### 7. ping 测试（arp, icmp,ip,udp,vxlan）

在252主机的vpp中添加trace

```
vppctl trace add dpdk-input 10
```

在VM1中输入ping指令：

![](http://oc15i8gxi.bkt.clouddn.com/vpp-doc/1/Screenshot%20from%202017-03-28%2010-26-45.png)

252 trace 结果
```
[root@localhost zym]# vppctl show trace
------------------- Start of thread 0 vpp_main -------------------
Packet 1

00:13:30:055494: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4c56: current data 14, length 78, free-list 0, totlen-nifb 0, trace 0x0
  PKT MBUF: port 0, nb_segs 1, pkt_len 92
    buf_len 2176, data_len 92, ol_flags 0x88, data_off 128, phys_addr 0x3d6f3cc0
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 78, checksum 0xa996
    fragment id 0x0000
  UDP: 3281 -> 4789
    length 58, checksum 0x0000
00:13:30:055515: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 78, checksum 0xa996
    fragment id 0x0000
  UDP: 3281 -> 4789
    length 58, checksum 0x0000
00:13:30:055530: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 78, checksum 0xa996
    fragment id 0x0000
  UDP: 3281 -> 4789
    length 58, checksum 0x0000
00:13:30:055537: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 78, checksum 0xa996
      fragment id 0x0000
    UDP: 3281 -> 4789
      length 58, checksum 0x0000
00:13:30:055538: ip4-udp-lookup
  UDP: src-port 3281 dst-port 4789
00:13:30:055544: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:30:055549: l2-input
  l2-input: sw_if_index 3 dst ff:ff:ff:ff:ff:ff src 52:54:00:01:00:33
00:13:30:055555: l2-learn
  l2-learn: sw_if_index 3 dst ff:ff:ff:ff:ff:ff src 52:54:00:01:00:33 bd_index 1
00:13:30:055560: l2-flood
  l2-flood: sw_if_index 3 dst ff:ff:ff:ff:ff:ff src 52:54:00:01:00:33 bd_index 1
00:13:30:055563: l2-output
  l2-output: sw_if_index 2 dst ff:ff:ff:ff:ff:ff src 52:54:00:01:00:33
00:13:30:055566: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  ARP: 52:54:00:01:00:33 -> ff:ff:ff:ff:ff:ff
  request, type ethernet/IP4, address size 6/4
  52:54:00:01:00:33/10.0.0.1 -> 00:00:00:00:00:00/10.0.0.2
00:13:30:055570: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 2

00:13:30:055744: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4c2f: current data 14, length 134, free-list 0, totlen-nifb 0, trace 0x1
  PKT MBUF: port 0, nb_segs 1, pkt_len 148
    buf_len 2176, data_len 148, ol_flags 0x88, data_off 128, phys_addr 0x3d6f3300
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:30:055746: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:30:055748: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:30:055748: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 134, checksum 0xa95e
      fragment id 0x0000
    UDP: 33234 -> 4789
      length 114, checksum 0x0000
00:13:30:055748: ip4-udp-lookup
  UDP: src-port 33234 dst-port 4789
00:13:30:055748: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:30:055749: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:30:055750: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:30:055751: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:30:055751: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:30:055751: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  ICMP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 84, checksum 0xe1c0
    fragment id 0x44e6, flags DONT_FRAGMENT
  ICMP echo_request checksum 0x9a5b
00:13:30:055751: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 3

00:13:31:056992: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4c08: current data 14, length 134, free-list 0, totlen-nifb 0, trace 0x2
  PKT MBUF: port 0, nb_segs 1, pkt_len 148
    buf_len 2176, data_len 148, ol_flags 0x88, data_off 128, phys_addr 0x3d6f2940
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:31:056993: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:31:056995: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:31:056996: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 134, checksum 0xa95e
      fragment id 0x0000
    UDP: 33234 -> 4789
      length 114, checksum 0x0000
00:13:31:056996: ip4-udp-lookup
  UDP: src-port 33234 dst-port 4789
00:13:31:056996: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:31:056997: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:31:056998: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:31:056999: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:31:056999: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:31:056999: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  ICMP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 84, checksum 0xe179
    fragment id 0x452d, flags DONT_FRAGMENT
  ICMP echo_request checksum 0x8254
00:13:31:057000: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 4

00:13:32:056910: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4be1: current data 14, length 134, free-list 0, totlen-nifb 0, trace 0x3
  PKT MBUF: port 0, nb_segs 1, pkt_len 148
    buf_len 2176, data_len 148, ol_flags 0x88, data_off 128, phys_addr 0x3d6f1f80
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:32:056912: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:32:056913: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:32:056914: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 134, checksum 0xa95e
      fragment id 0x0000
    UDP: 33234 -> 4789
      length 114, checksum 0x0000
00:13:32:056914: ip4-udp-lookup
  UDP: src-port 33234 dst-port 4789
00:13:32:056914: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:32:056915: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:32:056917: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:32:056917: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:32:056917: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:32:056918: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  ICMP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 84, checksum 0xde54
    fragment id 0x4852, flags DONT_FRAGMENT
  ICMP echo_request checksum 0xdd53
00:13:32:056918: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 5

00:13:33:056860: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4bba: current data 14, length 134, free-list 0, totlen-nifb 0, trace 0x4
  PKT MBUF: port 0, nb_segs 1, pkt_len 148
    buf_len 2176, data_len 148, ol_flags 0x88, data_off 128, phys_addr 0x3d6f15c0
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:33:056862: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:33:056864: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:33:056864: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 134, checksum 0xa95e
      fragment id 0x0000
    UDP: 33234 -> 4789
      length 114, checksum 0x0000
00:13:33:056864: ip4-udp-lookup
  UDP: src-port 33234 dst-port 4789
00:13:33:056865: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:33:056865: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:33:056867: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:33:056867: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:33:056867: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:33:056868: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  ICMP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 84, checksum 0xdad0
    fragment id 0x4bd6, flags DONT_FRAGMENT
  ICMP echo_request checksum 0xf152
00:13:33:056868: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 6

00:13:34:056906: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4b93: current data 14, length 134, free-list 0, totlen-nifb 0, trace 0x5
  PKT MBUF: port 0, nb_segs 1, pkt_len 148
    buf_len 2176, data_len 148, ol_flags 0x88, data_off 128, phys_addr 0x3d6f0c00
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:34:056907: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:34:056915: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:34:056915: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 134, checksum 0xa95e
      fragment id 0x0000
    UDP: 33234 -> 4789
      length 114, checksum 0x0000
00:13:34:056915: ip4-udp-lookup
  UDP: src-port 33234 dst-port 4789
00:13:34:056915: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:34:056916: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:34:056918: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:34:056918: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:34:056918: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:34:056918: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  ICMP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 84, checksum 0xd857
    fragment id 0x4e4f, flags DONT_FRAGMENT
  ICMP echo_request checksum 0xd551
00:13:34:056919: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 7

00:13:35:056882: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4b6c: current data 14, length 134, free-list 0, totlen-nifb 0, trace 0x6
  PKT MBUF: port 0, nb_segs 1, pkt_len 148
    buf_len 2176, data_len 148, ol_flags 0x88, data_off 128, phys_addr 0x3d6f0240
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:35:056884: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:35:056885: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:35:056886: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 134, checksum 0xa95e
      fragment id 0x0000
    UDP: 33234 -> 4789
      length 114, checksum 0x0000
00:13:35:056886: ip4-udp-lookup
  UDP: src-port 33234 dst-port 4789
00:13:35:056886: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:35:056887: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:35:056889: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:35:056889: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:35:056889: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:35:056889: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  ICMP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 84, checksum 0xd501
    fragment id 0x51a5, flags DONT_FRAGMENT
  ICMP echo_request checksum 0xea50
00:13:35:056889: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 8

00:13:35:063934: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4b45: current data 14, length 78, free-list 0, totlen-nifb 0, trace 0x7
  PKT MBUF: port 0, nb_segs 1, pkt_len 92
    buf_len 2176, data_len 92, ol_flags 0x88, data_off 128, phys_addr 0x3d6ef880
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 78, checksum 0xa996
    fragment id 0x0000
  UDP: 2402 -> 4789
    length 58, checksum 0x0000
00:13:35:063935: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 78, checksum 0xa996
    fragment id 0x0000
  UDP: 2402 -> 4789
    length 58, checksum 0x0000
00:13:35:063938: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 78, checksum 0xa996
    fragment id 0x0000
  UDP: 2402 -> 4789
    length 58, checksum 0x0000
00:13:35:063938: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 78, checksum 0xa996
      fragment id 0x0000
    UDP: 2402 -> 4789
      length 58, checksum 0x0000
00:13:35:063938: ip4-udp-lookup
  UDP: src-port 2402 dst-port 4789
00:13:35:063938: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:35:063939: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:35:063940: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:35:063940: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:35:063941: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:35:063941: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  ARP: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  reply, type ethernet/IP4, address size 6/4
  52:54:00:01:00:33/10.0.0.1 -> 52:54:00:01:00:44/10.0.0.2
00:13:35:063941: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 9

00:13:36:056929: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4b1e: current data 14, length 134, free-list 0, totlen-nifb 0, trace 0x8
  PKT MBUF: port 0, nb_segs 1, pkt_len 148
    buf_len 2176, data_len 148, ol_flags 0x88, data_off 128, phys_addr 0x3d6eeec0
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:36:056930: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:36:056932: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:36:056933: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 134, checksum 0xa95e
      fragment id 0x0000
    UDP: 33234 -> 4789
      length 114, checksum 0x0000
00:13:36:056933: ip4-udp-lookup
  UDP: src-port 33234 dst-port 4789
00:13:36:056933: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:36:056934: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:36:056935: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:36:056935: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:36:056935: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:36:056935: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  ICMP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 84, checksum 0xd388
    fragment id 0x531e, flags DONT_FRAGMENT
  ICMP echo_request checksum 0xe64f
00:13:36:056936: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 10

00:13:37:056858: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x4af7: current data 14, length 134, free-list 0, totlen-nifb 0, trace 0x9
  PKT MBUF: port 0, nb_segs 1, pkt_len 148
    buf_len 2176, data_len 148, ol_flags 0x88, data_off 128, phys_addr 0x3d6ee500
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:37:056860: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:37:056861: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 134, checksum 0xa95e
    fragment id 0x0000
  UDP: 33234 -> 4789
    length 114, checksum 0x0000
00:13:37:056862: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 134, checksum 0xa95e
      fragment id 0x0000
    UDP: 33234 -> 4789
      length 114, checksum 0x0000
00:13:37:056862: ip4-udp-lookup
  UDP: src-port 33234 dst-port 4789
00:13:37:056862: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
00:13:37:056863: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:37:056865: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:37:056865: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
00:13:37:056865: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
00:13:37:056876: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  ICMP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 84, checksum 0xcfcd
    fragment id 0x56d9, flags DONT_FRAGMENT
  ICMP echo_request checksum 0xef4e
00:13:37:056877: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

```

### 8. iperf 测试 （tcp）

在252主机的vpp中添加trace

```
[root@localhost zym]# vppctl clear trace

[root@localhost zym]# vppctl trace add dpdk-input 5

```
在VM2上启动iperf服务器：
```
iperf3 -s
```

在VM1中输入指令：
```
[root@localhost ~]# iperf3 -c 10.0.0.2 -t 30
Connecting to host 10.0.0.2, port 5201
[  4] local 10.0.0.1 port 51666 connected to 10.0.0.2 port 5201
[ ID] Interval           Transfer     Bandwidth       Retr  Cwnd
[  4]   0.00-1.00   sec   880 MBytes  7.37 Gbits/sec    0   1.56 MBytes       
[  4]   1.00-2.00   sec  1.03 GBytes  8.90 Gbits/sec    0   1.65 MBytes       
[  4]   2.00-3.00   sec  1.06 GBytes  9.10 Gbits/sec  326   1.29 MBytes       
[  4]   3.00-4.00   sec  1.06 GBytes  9.13 Gbits/sec    0   1.39 MBytes       
[  4]   4.00-5.00   sec   896 MBytes  7.51 Gbits/sec    0   1.48 MBytes       
[  4]   5.00-6.00   sec   979 MBytes  8.21 Gbits/sec    0   1.55 MBytes       
[  4]   6.00-7.00   sec  1.06 GBytes  9.11 Gbits/sec    0   1.57 MBytes       
[  4]   7.00-8.00   sec  1.05 GBytes  8.97 Gbits/sec    0   1.57 MBytes       
[  4]   8.00-9.00   sec  1.01 GBytes  8.67 Gbits/sec    0   1.57 MBytes       
[  4]   9.00-10.00  sec  1.02 GBytes  8.79 Gbits/sec    0   1.57 MBytes       
[  4]  10.00-11.00  sec  1.03 GBytes  8.87 Gbits/sec    0   1.57 MBytes       
[  4]  11.00-12.00  sec  1.06 GBytes  9.08 Gbits/sec  371   1.30 MBytes       
[  4]  12.00-13.00  sec  1.06 GBytes  9.12 Gbits/sec    0   1.35 MBytes       
[  4]  13.00-14.00  sec  1.06 GBytes  9.11 Gbits/sec    0   1.39 MBytes       
[  4]  14.00-15.00  sec  1.04 GBytes  8.92 Gbits/sec  274   1.27 MBytes       
[  4]  15.00-16.00  sec  1.06 GBytes  9.12 Gbits/sec    0   1.31 MBytes       
[  4]  16.00-17.00  sec  1.06 GBytes  9.11 Gbits/sec    0   1.37 MBytes       
[  4]  17.00-18.00  sec   922 MBytes  7.73 Gbits/sec    0   1.38 MBytes       
[  4]  18.00-19.00  sec   946 MBytes  7.94 Gbits/sec    0   1.40 MBytes       
[  4]  19.00-20.00  sec  1.06 GBytes  9.12 Gbits/sec    0   1.45 MBytes       
[  4]  20.00-21.00  sec  1.04 GBytes  8.94 Gbits/sec    0   1.55 MBytes       
[  4]  21.00-22.00  sec  1.02 GBytes  8.73 Gbits/sec    0   1.57 MBytes       
[  4]  22.00-23.00  sec   909 MBytes  7.62 Gbits/sec    0   1.57 MBytes       
[  4]  23.00-24.00  sec   977 MBytes  8.20 Gbits/sec  186   1.26 MBytes       
[  4]  24.00-25.00  sec  1.06 GBytes  9.12 Gbits/sec    0   1.34 MBytes       
[  4]  25.00-26.00  sec  1.06 GBytes  9.11 Gbits/sec    0   1.42 MBytes       
[  4]  26.00-27.00  sec  1.04 GBytes  8.97 Gbits/sec  250   1.27 MBytes       
[  4]  27.00-28.00  sec  1.06 GBytes  9.11 Gbits/sec    0   1.34 MBytes       
[  4]  28.00-29.00  sec  1.06 GBytes  9.12 Gbits/sec    0   1.38 MBytes       
[  4]  29.00-30.00  sec  1.06 GBytes  9.11 Gbits/sec    0   1.43 MBytes       
- - - - - - - - - - - - - - - - - - - - - - - - -
[ ID] Interval           Transfer     Bandwidth       Retr
[  4]   0.00-30.00  sec  30.5 GBytes  8.73 Gbits/sec  1407             sender
[  4]   0.00-30.00  sec  30.5 GBytes  8.73 Gbits/sec                  receiver
```

252 trace 结果
```
[root@localhost zym]# vppctl show trace
------------------- Start of thread 0 vpp_main -------------------
Packet 1

01:12:44:200491: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x11178: current data 14, length 110, free-list 0, totlen-nifb 0, trace 0x0
  PKT MBUF: port 0, nb_segs 1, pkt_len 124
    buf_len 2176, data_len 124, ol_flags 0x88, data_off 128, phys_addr 0x3da08540
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 110, checksum 0xa976
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 90, checksum 0x0000
01:12:44:200502: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 110, checksum 0xa976
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 90, checksum 0x0000
01:12:44:200510: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 110, checksum 0xa976
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 90, checksum 0x0000
01:12:44:200513: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 110, checksum 0xa976
      fragment id 0x0000
    UDP: 43138 -> 4789
      length 90, checksum 0x0000
01:12:44:200515: ip4-udp-lookup
  UDP: src-port 43138 dst-port 4789
01:12:44:200517: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
01:12:44:200521: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:200525: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:200529: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:200530: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:200532: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  TCP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 60, checksum 0xae91
    fragment id 0x7828, flags DONT_FRAGMENT
01:12:44:200534: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 2

01:12:44:200726: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x20bc5: current data 14, length 102, free-list 0, totlen-nifb 0, trace 0x1
  PKT MBUF: port 0, nb_segs 1, pkt_len 116
    buf_len 2176, data_len 116, ol_flags 0x88, data_off 128, phys_addr 0x3ddf1880
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 102, checksum 0xa97e
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 82, checksum 0x0000
01:12:44:200728: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 102, checksum 0xa97e
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 82, checksum 0x0000
01:12:44:200729: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 102, checksum 0xa97e
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 82, checksum 0x0000
01:12:44:200730: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 102, checksum 0xa97e
      fragment id 0x0000
    UDP: 43138 -> 4789
      length 82, checksum 0x0000
01:12:44:200730: ip4-udp-lookup
  UDP: src-port 43138 dst-port 4789
01:12:44:200730: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
01:12:44:200730: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:200732: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:200732: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:200732: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:200732: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  TCP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 52, checksum 0xae98
    fragment id 0x7829, flags DONT_FRAGMENT
01:12:44:200732: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 3

01:12:44:200749: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x18fea: current data 14, length 139, free-list 0, totlen-nifb 0, trace 0x2
  PKT MBUF: port 0, nb_segs 1, pkt_len 153
    buf_len 2176, data_len 153, ol_flags 0x88, data_off 128, phys_addr 0x3dc021c0
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 13
1124
vppctl show trace9, checksum 0xa959
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 119, checksum 0x0000
01:12:44:200750: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 139, checksum 0xa959
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 119, checksum 0x0000
01:12:44:200752: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 139, checksum 0xa959
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 119, checksum 0x0000
01:12:44:200752: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 139, checksum 0xa959
      fragment id 0x0000
    UDP: 43138 -> 4789
      length 119, checksum 0x0000
01:12:44:200752: ip4-udp-lookup
  UDP: src-port 43138 dst-port 4789
01:12:44:200752: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
01:12:44:200752: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:200753: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:200753: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:200753: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:200754: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  TCP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 89, checksum 0xae72
    fragment id 0x782a, flags DONT_FRAGMENT
01:12:44:200754: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 4

01:12:44:201705: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0x1e4ec: current data 14, length 102, free-list 0, totlen-nifb 0, trace 0x3
  PKT MBUF: port 0, nb_segs 1, pkt_len 116
    buf_len 2176, data_len 116, ol_flags 0x88, data_off 128, phys_addr 0x3dd56240
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 102, checksum 0xa97e
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 82, checksum 0x0000
01:12:44:201707: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 102, checksum 0xa97e
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 82, checksum 0x0000
01:12:44:201710: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 102, checksum 0xa97e
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 82, checksum 0x0000
01:12:44:201710: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 102, checksum 0xa97e
      fragment id 0x0000
    UDP: 43138 -> 4789
      length 82, checksum 0x0000
01:12:44:201710: ip4-udp-lookup
  UDP: src-port 43138 dst-port 4789
01:12:44:201710: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
01:12:44:201711: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:201712: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:201712: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:201712: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:201712: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  TCP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 52, checksum 0xae96
    fragment id 0x782b, flags DONT_FRAGMENT
01:12:44:201713: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1

Packet 5

01:12:44:201757: dpdk-input
  TenGigabitEthernet81/0/0 rx queue 0
  buffer 0xaf83: current data 14, length 106, free-list 0, totlen-nifb 0, trace 0x4
  PKT MBUF: port 0, nb_segs 1, pkt_len 120
    buf_len 2176, data_len 120, ol_flags 0x88, data_off 128, phys_addr 0x3d880800
    packet_type 0x0
    Packet Offload Flags
      PKT_RX_L4_CKSUM_BAD (0x0008) L4 cksum of RX pkt. is not OK
      PKT_RX_IP_CKSUM_GOOD (0x0080) IP cksum of RX pkt. is valid
  IP4: 90:e2:ba:9a:f1:d8 -> 90:e2:ba:9a:74:34
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 106, checksum 0xa97a
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 86, checksum 0x0000
01:12:44:201758: ip4-input-no-checksum
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 106, checksum 0xa97a
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 86, checksum 0x0000
01:12:44:201759: ip4-lookup
  fib 0 dpo-idx 5 flow hash: 0x00000000
  UDP: 10.3.0.1 -> 10.3.0.2
    tos 0x00, ttl 253, length 106, checksum 0xa97a
    fragment id 0x0000
  UDP: 43138 -> 4789
    length 86, checksum 0x0000
01:12:44:201759: ip4-local
    UDP: 10.3.0.1 -> 10.3.0.2
      tos 0x00, ttl 253, length 106, checksum 0xa97a
      fragment id 0x0000
    UDP: 43138 -> 4789
      length 86, checksum 0x0000
01:12:44:201759: ip4-udp-lookup
  UDP: src-port 43138 dst-port 4789
01:12:44:201759: vxlan4-input
  VXLAN decap from vxlan_tunnel0 vni 200 next 1 error 0
01:12:44:201759: l2-input
  l2-input: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:201762: l2-learn
  l2-learn: sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:201762: l2-fwd
  l2-fwd:   sw_if_index 3 dst 52:54:00:01:00:44 src 52:54:00:01:00:33 bd_index 1
01:12:44:201762: l2-output
  l2-output: sw_if_index 2 dst 52:54:00:01:00:44 src 52:54:00:01:00:33
01:12:44:201762: VirtualEthernet0/0/0-output
  VirtualEthernet0/0/0
  IP4: 52:54:00:01:00:33 -> 52:54:00:01:00:44
  TCP: 10.0.0.1 -> 10.0.0.2
    tos 0x00, ttl 64, length 56, checksum 0xae91
    fragment id 0x782c, flags DONT_FRAGMENT
01:12:44:201762: VirtualEthernet0/0/0-tx
     VirtualEthernet0/0/0 queue 0
   virtio flags:
    SINGLE_DESC Single descriptor packet
   virtio_net_hdr first_desc_len 4096
     flags 0x00 gso_type 0
     num_buff 1


```
